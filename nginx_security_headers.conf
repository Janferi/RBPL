# =============================================================================
# NGINX SECURITY CONFIGURATION FOR CRUZ COFFEE
# =============================================================================
#
# INSTALLATION INSTRUCTIONS:
# 
# 1. Open Laragon > Right-click > nginx > sites-enabled
# 2. Edit the file: auto.CRUZ.test.conf
# 3. Add the security headers inside the server { } block
# 4. Restart nginx: Laragon > Right-click > nginx > Reload
#
# =============================================================================

# Add these lines INSIDE your server { } block:

server {
    listen 80;
    server_name CRUZ.test *.CRUZ.test;
    root "D:/Computer/Laragon/laragon/www/CRUZ/";
    
    index index.php index.html index.htm;
    
    # =========================================================================
    # HIDE SERVER VERSION INFORMATION
    # =========================================================================
    # Prevents: "Server Leaks Version Information via Server HTTP Response Header"
    server_tokens off;
    
    # =========================================================================
    # SECURITY HEADERS
    # =========================================================================
    
    # Anti-Clickjacking Protection
    # Prevents: "Missing Anti-clickjacking Header"
    add_header X-Frame-Options "SAMEORIGIN" always;
    
    # Prevent MIME type sniffing
    # Prevents: "X-Content-Type-Options Header Missing"
    add_header X-Content-Type-Options "nosniff" always;
    
    # XSS Protection for older browsers
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Content Security Policy
    # Prevents: "Content Security Policy (CSP) Header Not Set"
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:; img-src 'self' data: blob: https:; connect-src 'self'; frame-ancestors 'self'; form-action 'self'; base-uri 'self'; object-src 'none';" always;
    
    # Referrer Policy
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # Permissions Policy
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=()" always;
    
    # Cross-Origin Policies
    add_header Cross-Origin-Opener-Policy "same-origin" always;
    add_header Cross-Origin-Resource-Policy "same-origin" always;
    
    # =========================================================================
    # PHP CONFIGURATION
    # =========================================================================
    
    location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }
    
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass php_upstream;
        
        # Hide PHP version
        # Prevents: "Server Leaks Information via X-Powered-By"
        fastcgi_hide_header X-Powered-By;
    }
    
    # =========================================================================
    # CUSTOM ERROR PAGES
    # =========================================================================
    # Prevents error pages from leaking server information
    
    error_page 404 /404.php;
    error_page 500 502 503 504 /500.php;
    
    # Deny access to sensitive files
    location ~ /\. {
        deny all;
    }
    
    location ~ ^/(logs|security_headers\.php|nginx_security_headers\.conf)$ {
        deny all;
    }
}

# =============================================================================
# ADDITIONAL LARAGON PHP.INI SETTINGS
# =============================================================================
# 
# Open Laragon > Right-click > PHP > php.ini
# Find and modify these settings:
#
# expose_php = Off                    ; Hides X-Powered-By header
# display_errors = Off                ; Prevents error disclosure  
# log_errors = On                     ; Log errors instead of displaying
# error_log = "logs/php_errors.log"   ; Where to log errors
#
# =============================================================================
